# 7. Gatekeeper Avançado: Monitorização Contínua 24/7

## ⚠️ IMPORTANTE: Ordem na Raiz do Projeto

**A Ordem deve estar sempre na raiz do projeto!**

Se clonaste a Ordem, o caminho deve ser:

```
/Users/teu_nome/teu_projeto/ordem/
```

**NÃO** dentro de subpastas como:

```
❌ /Users/teu_nome/teu_projeto/meu_app/ordem/
❌ /Users/teu_nome/teu_projeto/src/ordem/
```

## 🛡️ O que é o Gatekeeper Avançado?

O **Gatekeeper Avançado** é um sistema de monitorização contínua que:

- 🔍 Verifica a saúde do sistema a cada 60 segundos
- 📝 Guarda logs automáticos para análise
- ⚠️ Alerta para problemas de rede, disco, memória
- 🛡️ Protege o sistema 24/7

## 🚀 Como Ativar

### 1. Tornar Executável (Copiar e Colar)

```bash
chmod +x ordem/gatekeeper_avancado/gatekeeper_avancado_loop.sh
```

### 2. Ativar o Gatekeeper Avançado

```bash
./ordem/gatekeeper_avancado/gatekeeper_avancado_loop.sh
```

**Resultado esperado:**

```
[INFO] [2025-10-02 16:05:42] 🛡️ WATCHDOG INICIADO
[INFO] [2025-10-02 16:05:42] 🔍 Monitorização contínua ativada
[INFO] [2025-10-02 16:05:42] ⏰ Intervalo normal: 60s
[INFO] [2025-10-02 16:05:42] 📝 Logs em: .../gatekeeper_avancado_20251002.log
[INFO] [2025-10-02 16:05:42] ▶️ Diagnóstico iniciado
[INFO] [2025-10-02 16:05:42] ✅ Conectividade de rede: OK
[INFO] [2025-10-02 16:05:42] ✅ Espaço em disco: OK (5% usado)
[WARNING] [2025-10-02 16:05:42] ⚠️ Memória: ALTA (100% usado)
[WARNING] [2025-10-02 16:05:42] ⚠️ Servidor Python: INATIVO
[INFO] [2025-10-02 16:05:42] ✅ Logs de sistema: SEM ERROS RECENTES
[INFO] [2025-10-02 16:05:42] ✅ Ficheiro crítico: /etc/passwd existe
[INFO] [2025-10-02 16:05:42] ✅ Diagnóstico concluído
[INFO] [2025-10-02 16:05:42] 💤 Aguardando 60s até próximo ciclo...
```

## 🛑 Como Parar

### 3.1. Interrupção Limpa (Recomendado)

```bash
# No terminal onde está a correr, pressiona:
Ctrl + C
```

**Resultado esperado:**

```
^C
[INFO] [2025-10-02 16:10:42] 🛑 WATCHDOG PARADO (interrupção limpa)
[INFO] [2025-10-02 16:10:42] 📝 Logs guardados em: .../gatekeeper_avancado_20251002.log
```

### 3.2. Remover Lockfile (Se Ctrl+C não funcionar)

```bash
rm ordem/gatekeeper_avancado/.gatekeeper_avancado.lock
```

**Quando usar:**

- Se o terminal não responde ao Ctrl+C
- Se o processo ficou "preso"
- Para forçar paragem completa

### 3.3. Matar Processo (Último recurso)

```bash
# Encontrar o processo
ps aux | grep gatekeeper_avancado_loop.sh

# Matar o processo (substitui XXXX pelo PID)
kill -9 XXXX
```

**Quando usar:**

- Apenas se as outras opções falharem
- Processo completamente bloqueado
- Sistema não responde

## 📊 O que Significam os Avisos?

### ✅ **Verde (OK):**

- `Conectividade de rede: OK` - Internet funcionando
- `Espaço em disco: OK` - Disco com espaço suficiente
- `Logs de sistema: SEM ERROS` - Sistema estável
- `Ficheiro crítico: existe` - Ficheiros importantes presentes

### ⚠️ **Amarelo (Atenção):**

- `Memória: ALTA (100% usado)` - **Normal no macOS**
- `Servidor Python: INATIVO` - **Normal se não tiveres servidor Python**

### ❌ **Vermelho (Problema):**

- `Conectividade de rede: FALHA` - Problemas de internet
- `Espaço em disco: CRÍTICO` - Disco quase cheio
- `Logs de sistema: ERROS` - Problemas no sistema

## 📝 Logs Automáticos

Os logs são guardados automaticamente em:

```
ordem/gatekeeper_avancado/gatekeeper_avancado_logs/
└── gatekeeper_avancado_YYYYMMDD.log
```

**Exemplo de log:**

```
[INFO] [2025-10-02 16:05:42] 🛡️ WATCHDOG INICIADO
[INFO] [2025-10-02 16:05:42] ✅ Conectividade de rede: OK
[INFO] [2025-10-02 16:05:42] ✅ Espaço em disco: OK (5% usado)
[WARNING] [2025-10-02 16:05:42] ⚠️ Memória: ALTA (100% usado)
```

## 🎯 Resumo Rápido

1. **Ativar**: `./ordem/gatekeeper_avancado/gatekeeper_avancado_loop.sh`
2. **Parar**: `Ctrl + C` (interrupção limpa)
3. **Forçar paragem**: `rm ordem/gatekeeper_avancado/.gatekeeper_avancado.lock`
4. **Logs**: Guardados automaticamente em `gatekeeper_avancado_logs/`

O **Gatekeeper Avançado** protege o teu sistema 24/7! 🛡️
